checkout:
    post:
        - cd ..; hg clone https://hg.mozilla.org/projects/nspr

dependencies:
    pre:
        - sudo apt-get update; sudo apt-get remove clang; sudo apt-get install clang-3.4 libclang-common-3.4-dev libllvm3.4=1:3.4-1ubuntu3~precise2

test:
    override:
        - scan-build make nss_build_all
        - cd tests; NSS_TESTS="ssl_gtests pk11_gtests der_gtests" NSS_CYCLES=standard scan-build ./all.sh
        - BUILD_OPT=1 make nss_build_all
        - cd tests; BUILD_OPT=1 NSS_TESTS="ssl_gtests pk11_gtests der_gtests" NSS_CYCLES=standard ./all.sh
    post:
        - mkdir $CIRCLE_ARTIFACTS/scan-build
        - mv /tmp/scan-build* $CIRCLE_ARTIFACTS/scan-build

machine:
    environment:
        { USE_64: 1,
          NSS_ENABLE_TLS_1_3: 1,
        }
    hosts:


